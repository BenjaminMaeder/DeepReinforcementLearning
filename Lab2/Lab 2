
{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 61,
   "metadata": {},
   "outputs": [],
   "source": [
    "\"\"\"\n",
    "This project was developed by Peter Chen, Rocky Duan, Pieter Abbeel for the Berkeley Deep RL Bootcamp, August 2017.\n",
    "Bootcamp website with slides and lecture videos: https://sites.google.com/view/deep-rl-bootcamp/.\n",
    "\n",
    "Code adapted from Stanford CS231N materials: http://cs231n.stanford.edu/\n",
    "\"\"\"\n",
    "\n",
    "\n",
    "# note to properly run this lab, you should execute all code blocks sequentially\n",
    "import chainer\n",
    "import chainer.functions as F\n",
    "import chainer.links as L\n",
    "from chainer import training\n",
    "from chainer.training import extensions\n",
    "\n",
    "from collections import namedtuple, defaultdict, deque\n",
    "\n",
    "import numpy as np\n",
    "\n",
    "%matplotlib inline\n",
    "\n",
    "import matplotlib\n",
    "import matplotlib.pyplot as plt"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction to Chainer\n",
    "\n",
    "Chainer can be understood as Numpy plus the ability to record the computation graph of numerical operations to enable Automatic Differentiation. (Chainer actually also offers many other things; for example, a Numpy equivalent library that runs on GPU, but we will ignore them for now)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Let's illustrate how Chainer works by a simple 1D regression task.\n",
    "\n",
    "Suppose we have observations from the following model $y = w x + b + \\epsilon$ where $\\epsilon \\sim \\mathcal{N}(0, 0.1)$ and the task is to estimate the linear model parameters $w, b$ from data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 62,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAX8AAAD8CAYAAACfF6SlAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDMuMC4wLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvqOYd8AAAHA5JREFUeJzt3X+sZOV93/H3B8gm3PpHzO7Gpix7l9S4ysatTPeKxqraKDJpFv6AqLIdyLLBEu7KdWhVuY6KhVVVVKs6jipHVWmVbfMD793WxpZSrxwiErtOUyFjcVFsVGwBC2WXDchcsw6ShRPi8O0fZyacO5yZOWfOc2bOj89LGt07M8+dcw4rvueZ7/N9nkcRgZmZDctFqz4BMzNbPgd/M7MBcvA3MxsgB38zswFy8DczGyAHfzOzAXLwNzMbIAd/M7MBcvA3MxugS1Z9AtPs2bMnDhw4sOrTMDPrlEceeeQ7EbF3XrvWBv8DBw6wtbW16tMwM+sUSWfLtHPax8xsgBz8zcwGyMHfzGyAHPzNzAbIwd/MbIAc/M3MBsjB38xsgBz8zWywTp2CAwfgoouyn6dOrfqMlsfB38wG6dQpOHYMzp6FiOznsWPlbwBdv3E4+JvZIN11F7z88s7XXn45e32eujeONnDwN7NBOneu2ut5dW4cbeHgb2aDtH9/tdfzFrlxtC1N5OBvZoN0/Disre18bW0te32eqjeONqaJHPzNbJCOHIETJ2B9HaTs54kT2evzVL1xtDFNpIhY3dFn2NjYCC/pbGZtdepUFrzPnct6/MePT79xXHRR1uOfJMGrr6Y9L0mPRMTGvHbu+ZuZLeDIEXjmmSx4P/NMceAf5/mn9bHLjC80JUnwl/Rbkl6Q9H+nvC9J/1HSGUmPSvp7KY5rZtZW+Tx/kbLjC01J1fP/HeDwjPevB64ePY4B/yXRcc3MWqkozz9WZXyhKUmCf0T8MXBhRpObgE9H5iHgRyVdnuLYZmZtNK3sU9qZJlpVCeiycv5XAM/mnp8fvWZm1ktlykFXWQK6rOCvgtdeNwQi6ZikLUlb29vbSzgtM7NmlCkHXWUJ6LKC/3ngytzzfcBzk40i4kREbETExt69e5d0amZm9eRTN3v2ZI+jR+HSS2H37unzCOosMVHXsoL/aeCXRlU/PwW8FBHPL+nYZmaNmUzdvPhi9hj//v3vw8mTxeWgdZaYqCtVqef/AL4K/G1J5yXdLulDkj40anI/8DRwBvivwIdTHNfMbNVmVfVAcRpn/E3h7NnsW0HeskpAL0nxIRFxy5z3A/jlFMcyM2uTMimafJvxN4XxDSMiuwFEZKmhWTOFU0oS/M3Mhmr//ukTufJtxoq+KYwD/zPPJD+9qby8g5lZDUVVPXmTaZxVDvLmOfibWau0bd37eSZXB929e3aFzyoHefMc/M2sNVJOemriJjLtM/OLvH3nO9lj2oJvdfYRSCoiWvk4dOhQmNmwrK9HZGF/52N9vdzfb26+9hnSzs9YW8veX9TmZvYZKT5zfJ5S9rPOeU0CtqJEjPV6/mbWGnXWvZ+soilSZ1B1XJqZ8jOb4PX8zaxz6uTD59XbQ71B1bYM1Kbi4G9myS2ab6+TDy8ThOsMqrZloDYVB38zS6rOoG2dfXXnBeG6g6qtGahNxDl/M0tqVbnxopx/ipmz+b16L7sse+3Chfn79q5K2Zy/Z/iaWVKryo2Pg3DZTdXLmLyhvPhi1ts/ebJ9Qb8q9/zNLKmuVMWU0cVrcbWPma1En3LjfavwyXPwN7Ok6gzatk3fKnzyHPzNLLn8cgdFSxx0RZ++xUxy8Dczm6JP32ImudrHzGyGI0f6EewnuedvZp3QtaWe2849fzNrvcl6+/GsYehnr3wZUm3gfljS45LOSLqz4P39kr4i6U8kPSrphhTHNbNuWbT3XrRoW9HG6FZe7eAv6WLgHuB64CBwi6SDE80+DtwXEdcANwP/ue5xzaxb6qz5k7LevswNaAgpphQ9/2uBMxHxdES8AnwGuGmiTQBvGv3+ZuC5BMc1sw5ZpPc+DsLTFiKoWm9f5gaUcjexNqu9vIOk9wKHI+KDo+dHgb8fEXfk2lwO/AHwFuBvANdFxCMFn3UMOAawf//+Q2eL5lWbWSdV3ahl3uYsa2vVyy7LLNfQxSUd8pa5vIMKXpv8J74F+J2I2AfcAJyU9LpjR8SJiNiIiI29e/cmODUza4uqs2Vnbc6yaL19mfRRn5d0yEsR/M8DV+ae7+P1aZ3bgfsAIuKrwI8AexIc28w6oups2WnBVlp81nCZG1Cfl3TISxH8HwaulnSVpF1kA7qnJ9qcA94DIOknyIL/doJjm1lHVJ0t20QQLnMD6vOSDjuU2eV93oMslfME8BRw1+i1u4EbR78fBB4EvgF8HfjH8z7z0KFD6bazN7NW29yMWF+PkLKfm5vZY20tIhspyB5ra9nrqY+1SJu2AraiTNwu02gVDwd/s25ZNGDOCvJ9D9RNKBv8vZmLmdVWVJlTthqnTnVNneP2lTdzMbOlqTMDt051TcqZv0OY2JXn4G9mtdUJ4HUGdlOVZQ5lYleeg7+Z1VYngNeprklVETTEtYMc/M2stjoBvM6GKanKMocysSvPwd/Maqu749Wi2z6m2mlrKBO78lztY2aD16eqIVf7mFmrtam6ps979U7j4G9mC1s0gLexumbR1FNXOfib2ULqBPAhVte0jYO/mS1kVRO7FtGmFFNbOPib9ViTQW9VE7uqamOKqQ0c/M16qumgt6qJXVDtpuYUUzEHf7OeajrorWpiV9Wb2hAncJXhOn+znpq2Zy5kwfb48foVLadOZTeTc+eyHn+Kz5yn6iqgXd+TtyrX+ZsN3Kz0S763XGdcoEx5ZOpxh6o9+cHszFVVmUX/V/HwZi5m9RRtkjL52L27md2yZp1D3c9fXy++lvX12ecxlA1f8GYuZjZOyxSlPWZJlRJpIuXSp6UYmrDUtI+kw5Iel3RG0p1T2rxf0jclPSbpv6c4rpnNNk7LrK9X+7vJFMqiqZsmBluHuBRDE2oHf0kXA/cA15Nt1H6LpIMTba4GPgb8g4j4SeBf1j2umZVXlPeWprffv/+1gC/B0aOLlYw2Vc8/tKUYmpCi538tcCYino6IV4DPADdNtPmnwD0R8V2AiHghwXHNrKR8bxmygD4t47u2Bjfc8Fo5Jby+bdmSUQ+2tleK4H8F8Gzu+fnRa3nvAN4h6UFJD0k6XPRBko5J2pK0tb29neDUzGwsnwKaVQJ64gTcf//r5whMOnt2fgrIKZr2qj3gK+l9wM9FxAdHz48C10bEP8+1+SLwl8D7gX3A/wHeGRF/Nu1zPeBr1oxp9f9SlkaZ1aaIB1vbZZkDvueBK3PP9wHPFbT5QkT8ZUT8P+Bx4OoExzYbrEUHYcvk4avk5L1UQjelCP4PA1dLukrSLuBm4PREm/8J/AyApD1kaaCnExzbbJDqrNtTJg9fdYB46EsldFHt4B8RPwDuAB4AvgXcFxGPSbpb0o2jZg8AL0r6JvAV4Fci4sW6xzYbqjrr9pTJwxe1OXlyeslon/e67StP8jLroDJ5+yZ4glX7eW0fsx5b5nr4ea7e6Q8Hf7MOWmX9vCdY9YODv1kHuQdudTn4m3XUtB6496u1Mhz8zTpkXmD3frVWloO/WUeUCex1t270t4bhcKmnWUeUWRu/Tgmoyzj7waWeZj0x7o1P25AlP7u2Tglo0xu+W7s4+Ju1WD7VM00+sNcpAW1i4xVrLwd/s4bVyaMX9cbzJgN7nRLQVU0cs9Vw8DdrUN3qm1m97mmBfdFJWN54ZVgc/M0aNCuPXuYbwbRe93iQN+VArCeODYurfcwaNGtTlLW1+ZU1rsCxqlztYzbDsurZZ+XLy1TWlO2Nuz7fqnLP3wZnmb3pomPNssiSzP52YHlle/4O/jY4ZSZLpXTqVNajn1WuWeccln091m5O+5hNsex69nH1zaxtEAF+6Ifge9+rnrpxfb4twsHfBmdV9eyzPn/37uzm8OKL1UtCXZ9vi0gS/CUdlvS4pDOS7pzR7r2SQtLcryRmRVIMbK6qnn3acTc34Q1vgFde2fle2aUVXJ9vC4mIWg/gYuAp4MeBXcA3gIMF7d4I/DHwELAx73MPHToUZnmbmxFraxFZ3zh7rK1lry/yWevrEVL2s8pnNPG30s7rGj+k5s/J+gXYihKxu/aAr6R3A/82In5u9Pxjo5vKv59o9+vAl4CPAh+NiJmjuR7wtUltGNhsqrKmDddm/bDMAd8rgGdzz8+PXsufzDXAlRHxxQTHs4GaNbC5rDr3pla+dOrGli1F8C+qYfjrrxOSLgI+BfyruR8kHZO0JWlre3s7walZn0wbwLzssuXtXtVUZY2XVrBlSxH8zwNX5p7vA57LPX8j8E7gjyQ9A/wUcLpo0DciTkTERkRs7N27N8GpWZ9M6x1DM73xom8TTVbWLLogm9kiUgT/h4GrJV0laRdwM3B6/GZEvBQReyLiQEQcIBvwvXFezt9s0rTe8YULxe3r9ManrcZ5ww1Oz1g/1A7+EfED4A7gAeBbwH0R8ZikuyXdWPfzzfKKescpe+Pj3v6ttxZ/m7j//p03oN274dJL4ehRr6lj3eLlHazzUlXglFmHJ7/2jtfUsTby8g42GJPpoEV74/N2zYKd3ya85611mYO/9cI4HXTyJHz/+zuXSTh6NLspzLsRzBsjmMzte00d6zIHf+uVot74OLM5rwR01hhBUeml19SxLnPwt16Z1+uelZaZtfZOUenlrIlZ3lzF2s7B33qlTK972g2i6kSrae1heZPOzBbl4G+9UtQbnzR5g8j30u+6K/uMyYlW03ry+dLT48ezv59WJuqBYGuTS1Z9AmYpjYP1eOcsaecG6pODtpPlmuNeev6zFmlTxAPB1iau87deG2+heO5c1uM/fnxnGqfMapp12kxrb9YU7+FrVsJFF+38ZjCWn8xVp82YJ3/ZsniSl3XCqqtiypRr1mkDXqHT2snB31Zm2uJpy7wBlFlHv06baWWiZqvm4G9LN2/xtGVWxZQp70zVxqxNnPO3paq6eJqZVeOcv63EtBz+rN7+JC+PYNY81/lbMtPq4R98EO69d37QB2+MYrYs7vlbMtOWOD5xolzgd57cbHkc/C2ZaTNY/+qvZv/dolUxVctEV11WatYmDv6WzLRc/cUXT/+bRXv7VctE21BWatYmSYK/pMOSHpd0RtKdBe9/RNI3JT0q6cuS1lMc19plWq37sWPVa+Dn9dKr7qLlXbfMJkRErQdwMfAU8OPALuAbwMGJNj8DrI1+/2fAZ+d97qFDh8K6Z3MzYn09Qsp+bm7Ofn3aZ6ytRWR99Oyxtrbzb6Sd748fUvFnVm2/alX+e5nlAVtRJnaXaTTzA+DdwAO55x8DPjaj/TXAg/M+18G/GV0IKuvrxYF6fb1am6qf2RZlbn5m05QN/inSPlcAz+aenx+9Ns3twO8nOK5V1JW8d5m9ccssuZBXtf0qOUVly5Ai+KvgtcJpw5JuBTaAX5vy/jFJW5K2tre3E5ya5XUlqJRZSC3VrlttLCv1xvC2DCmC/3ngytzzfcBzk40kXQfcBdwYEX9R9EERcSIiNiJiY+/evQlOzfJSBpUmyybL9tLzu2iVKROt2n5VvDG8LUOK4P8wcLWkqyTtAm4GTucbSLoG+A2ywP9CgmPaAlIFlabTR5O99N274dJL4ejRYdTndylFZR1WZmBg3gO4AXiCrOrnrtFrd5MFe4AvAd8Gvj56nJ73mR7wTS/VQOK0wdPxAGrKgcmhDn52YWDe2omSA75e1XNg5m1rWMYyd60qs4Wimb3G2zhaY5a5X22ZLRTN7DVe0tkaU5STnpSqMsWDn2bNcPAfgNSVOfkB2WlSBWcPfpo1w8G/55qqzBmXTW5uNhucu1Sfb9YlDv49V3di17xvDcsIzl2pzzfrEg/49lydAdOi/XZTVvKYWXoe8F2CLmwOUmfAtCvLQZhZdQ7+C+rKImmzBkzn3by8xoxZfzn4L6grveJpOXmYf/Oa9u0gor3fdMysHOf8F9T1yUdlZs4W5fzznP83ax/n/BvW9clHZVI68+r52/hNx8zKcfBfUNcnH5W9eY3LLFW0awNp8/9dGEA36wsH/wV1ffJR1ZtX0990ujKAbtYXDv41tG3yUZWec9WbV9PfdLoygG7WFw7+PbFIz7nKzWuRbzpVbkYuKzVbLlf79ETb1r2vOju4bedv1lWu9qmhiwOPbes5V03jdH0A3axrHPwnFKVPjh7NUh1N3QhS3GzaVnpa9WbU9QF0s65JEvwlHZb0uKQzku4seP+HJX129P7XJB1IcdwmFPVYx5mxJipQUlW5tK3nvMjNqG0D6GZ9Vjv4S7oYuAe4HjgI3CLp4ESz24HvRsTbgU8Bv1r3uE2ZlyZJXYGSqsqlbT3ntt2MzGynFD3/a4EzEfF0RLwCfAa4aaLNTcC9o98/D7xHmjZtaLXKpElS5tFT5urb1HNu283IzHZKEfyvAJ7NPT8/eq2wTUT8AHgJ2J3g2MmV2Z82ZR59kfRIVwak23QzMrOdUgT/oh78ZP1omTZIOiZpS9LW9vZ2glOrbnI9m8nvJ6lTF2XTI+OAL2UD0J4Ja2Z1pAj+54Erc8/3Ac9NayPpEuDNwIXJD4qIExGxEREbe/fuTXBqixn3WCPg5MlmUhfjYH70KFx6KezePf0Y+UFheP1qop4Ja2ZV1Z7kNQrmTwDvAf4UeBj4xYh4LNfml4G/ExEfknQz8E8i4v2zPrfPk7xSTYDK68pS0mbWrKVN8hrl8O8AHgC+BdwXEY9JulvSjaNmvwnslnQG+AjwunLQIala4VNm8LfuOERXxhHMLI0kdf4RcX9EvCMi/lZEHB+99m8i4vTo9z+PiPdFxNsj4tqIeDrFcbuqaoXPvMA+a4ygTDD3ippmw+MZvitQtcKnaFB4PBA9b4ygTDCf9k3k1lv9LcCsrxz8l2jcGz97tloVUVHN/MmTWWAvKqFMmVbytwCzfvKqnktSNMgrZQF8fT0L/Knq4KvuL1xmQNmra5p1g1f1bJlpawaNg2rKCVAp0kqTvK6+Wb84+DegaLB1mUsuV11XZ95G7dCdjenNrBwH/8SmDbZedllx+yaC6iLr6owntm1uekE2syFw8K+gTPnktMFWqLaMQ916+0XX1fGCbGbD4AHfksrOyp022ArZEg4AFy5kPf7JQd6qM3/NzCaVHfB18C+p7B6z8ypnvI+tmTXJ1T6JlR2wnVc5s0i9vSttzCy1QQf/Kvn1suWTZSpnqi7j0Ie1/c2sXQYb/KsugVClfHI82DrtBlCl3n5WpY3X5DGzhUVEKx+HDh2KJq2vR2Qhc+djfX3632xuZu9L2c/NzdnH2NyMWFvb+flra7P/rsoxFrkGM+s3YCtKxNjBDvhWXQJhUadOZTn+c+eKK3zq/O2yrsHMuqPsgO8lyziZNtq/v7iyJvWkqyNHFivTnCz7HKd0xp8Jy7sGM+ufweb8q+bXl63MypxtvwYza6/BBv+2z2QtU/bZ9msws/YabM6/7Tzhy8wW4UleHeeUjpk1qVbwl3SZpD+U9OTo51sK2rxL0lclPSbpUUm/UOeYdXVlUpRTOmbWpFppH0mfBC5ExCck3Qm8JSL+9USbdwAREU9K+pvAI8BPRMSfzfrsJtI+XjjNzPpuWWmfm4B7R7/fC/z8ZIOIeCIinhz9/hzwArC35nEXUnVvWzOzvqob/N8aEc8DjH7+2KzGkq4FdgFPTXn/mKQtSVvb29s1T+31vHCamVlm7iQvSV8C3lbwVqX+sqTLgZPAbRFROP80Ik4AJyBL+1T5/DI8KcrMLDM3+EfEddPek/RtSZdHxPOj4P7ClHZvAn4P+HhEPLTw2dZ0/Hhxzt8VNGY2NHXTPqeB20a/3wZ8YbKBpF3A7wKfjojP1TxeLa6gMTPL1K322Q3cB+wHzgHvi4gLkjaAD0XEByXdCvw28FjuTz8QEV+f9dlDn+RlZrYIb+NoZjZAnuFrZmZTOfibmQ2Qg38iXVk2wswMBryZS0plNl4xM2sT9/wT8LIRZtY1Dv4JeNkIM+saB/8Epi0P4WUjzKytBhH8mx6M9cYrZtY1vQ/+48HYs2ch4rXB2JQ3AC8bYWZd0/sZvt4L18yGxDN8R8oOxrpO38yGpPfBv8xg7DJSQ2ZmbdLb4D/uyZ89m+Xh8yYHY12nb2ZD08vgn+/JQ9abH98AigZjXadvZkPTy+UdinryEdMHeb29o5kNTS97/lV78q7TN7Oh6WXwrzrj1nX6ZjY0vQz+i/TkjxzJUkKvvpr9dOA3sz6rFfwlXSbpDyU9Ofr5lhlt3yTpTyX9pzrHLMM9eTOz2er2/O8EvhwRVwNfHj2f5t8B/7vm8UpzT97MbLq6wf8m4N7R7/cCP1/USNIh4K3AH9Q8npmZJVA3+L81Ip4HGP38sckGki4C/gPwK/M+TNIxSVuStra3t2uempmZTTO3zl/Sl4C3FbxVdv7rh4H7I+JZTU61nRARJ4ATkC3sVvLzzcysornBPyKum/aepG9Lujwinpd0OfBCQbN3A/9Q0oeBNwC7JH0vImaND5iZWYPqzvA9DdwGfGL08wuTDSLir4daJX0A2HDgNzNbrbo5/08APyvpSeBnR8+RtCHpv9U9OTMza0bvN3MxMxuSspu5tDb4S9oGCpZb64w9wHdWfRJL5OvttyFdb9evdT0i9s5r1Nrg33WStsrcffvC19tvQ7reoVxrL9f2MTOz2Rz8zcwGyMG/OSdWfQJL5uvttyFd7yCu1Tl/M7MBcs/fzGyAHPwTaeveBk0pc72S3iXpq5Iek/SopF9YxbnWIemwpMclnZH0upnpkn5Y0mdH739N0oHln2UaJa71I5K+Ofq3/LKk9VWcZyrzrjfX7r2SQlKvKoAc/NNp7d4GDSlzvS8DvxQRPwkcBn5d0o8u8RxrkXQxcA9wPXAQuEXSwYlmtwPfjYi3A58CfnW5Z5lGyWv9E7LlWf4u8Hngk8s9y3RKXi+S3gj8C+Bryz3D5jn4pzO0vQ3mXm9EPBERT45+f45s4b+5k09a5FrgTEQ8HRGvAJ8hu+68/H+HzwPv0bzla9tp7rVGxFci4uXR04eAfUs+x5TK/NtC1lH7JPDnyzy5ZXDwTyfp3gYdMPd68yRdC+wCnlrCuaVyBfBs7vn50WuFbSLiB8BLwO6lnF1aZa4173bg9xs9o2bNvV5J1wBXRsQXl3liy1J3Vc9BWebeBm2Q4HrHn3M5cBK4LSJeTXFuS1L0jzRZHlemTReUvg5JtwIbwE83ekbNmnm9o47ap4APLOuEls3Bv4Kh7W2Q4HqR9Cbg94CPR8RDDZ1qU84DV+ae7wOem9LmvKRLgDcDF5ZzekmVuVYkXUd28//piPiLJZ1bE+Zd7xuBdwJ/NOqovQ04LenGiOjFipNO+6Qz3tsAZuxtEBH7I+IA8FHg020N/CXMvV5Ju4DfJbvOzy3x3FJ5GLha0lWja7mZ7Lrz8v8d3gv8r+jm5Jm51zpKg/wGcGNEFN7sO2Tm9UbESxGxJyIOjP5/fYjsunsR+MHBP6Wh7W1Q5nrfD/wj4AOSvj56vGs1p1vdKId/B/AA8C3gvoh4TNLdkm4cNftNYLekM8BHmF3l1Volr/XXyL6xfm70bzl5I+yMktfba57ha2Y2QO75m5kNkIO/mdkAOfibmQ2Qg7+Z2QA5+JuZDZCDv5nZADn4m5kNkIO/mdkA/X92xq94eAJEnQAAAABJRU5ErkJggg==\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# first generate some observations\n",
    "true_a = 1.3\n",
    "true_b = 0.4\n",
    "data_x = (np.arange(100) / 99.0 - .5).astype(np.float32) # Chainer assumes all the cpu computation is done in float32\n",
    "data_y = (data_x * true_a + true_b + np.random.randn(*data_x.shape) * 0.1).astype(np.float32)\n",
    "_ = plt.scatter(data_x, data_y, c='b')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Chainer provides an abstraction called `Link` that describe some computation and keeps track of parameters for it. For instance, a `Linear` link describes a linear map on input and keeps track of `w` and bias `b`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 63,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "w: variable W([[ 0.35864982]])\n",
      "b: variable b([ 0.])\n",
      "Operations on chainer.Variable: variable([[ 123.35865021]]), type: <class 'chainer.variable.Variable'>\n",
      "numpy arrays: [[ 0.35864982]] [[ 123.35865021]]\n"
     ]
    }
   ],
   "source": [
    "model = L.Linear(in_size=1, out_size=1) # input is 1D data and output is also 1D data\n",
    "\n",
    "# Chainer will randomly initialize `w` and `b` for us.\n",
    "# we can take a look at their values\n",
    "print(\"w:\", model.W)\n",
    "print(\"b:\", model.b)\n",
    "\n",
    "# model.W and model.b have type `chainer.Variable`, \n",
    "#   which is a wrapper around Numpy array\n",
    "assert isinstance(model.W, chainer.Variable)\n",
    "\n",
    "# operations that involve `chainer.Variable` will produce\n",
    "#   `chainer.Variable` and this records the computation graph\n",
    "var_result = model.W + 123 # some random computation\n",
    "print(\"Operations on chainer.Variable: %s, type: %s\" % (var_result, type(var_result)))\n",
    "\n",
    "# the underlying numpy array can be accessed by `data` attribute\n",
    "print(\"numpy arrays:\", model.W.data, var_result.data)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 64,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# A chainer link is a callable object. calling it performs the\n",
    "#   forward computation. (in this case, it performs Wx + b)\n",
    "model_y = model(data_x[:, None]) # chainer's link usually assumes input is [Batch Size, Input Dimension]\n",
    "# `model_y` is a chainer variable so we use `.data` to access its numpy array for plotting\n",
    "\n",
    "# we can plot the model's current fit in red. it should be terrible because we haven't trained it yet\n",
    "_ = plt.plot(data_x, model_y.data[:,0], c='r')\n",
    "_ = plt.scatter(data_x, data_y, c='b')\n",
    "_ = plt.title(\"Initial model\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "loss variable(0.21986638009548187)\n",
      "dloss/dW [[-0.14970335]]\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "array([[-0.14970335]], dtype=float32)"
      ]
     },
     "execution_count": 65,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# now let's walk through how to perform forward computation\n",
    "#  and use AD to get gradients\n",
    "\n",
    "# first we clear the gradients that are stored in the model\n",
    "model.cleargrads()\n",
    "# as we have seen we can perform forward computation by calling the link\n",
    "model_y = model(data_x[:, None])\n",
    "\n",
    "# remember that `model_y` is a chainer variable. to operate on chainer variable\n",
    "#    we will use functions from chainer.functions to operate on those objects.\n",
    "loss = F.mean(F.square(model_y - data_y[:, None]))\n",
    "# `loss` is a scalar chainer variable\n",
    "assert isinstance(loss, chainer.Variable)\n",
    "print(\"loss\", loss)\n",
    "# calculating gradients d loss /d params is as simple as\n",
    "loss.backward()\n",
    "\n",
    "# we can inspect the gradient of loss with respect to W\n",
    "print(\"dloss/dW\", model.W.grad)\n",
    "model.W.grad"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now that we know how to calculate gradients, we can code up a simple loop to perform gradient descent to train this model:\n",
    "\n",
    "(Hint: if you run into weird problems, maybe the state has been messed up and you can try re-runing all the code blocks from the beginning)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 81,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<chainer.links.connection.linear.Linear object at 0x0000021C3F709438>\n",
      "Itr 0 loss: variable(0.33760443329811096)\n",
      "Itr 25 loss: variable(0.011036694049835205)\n",
      "Itr 50 loss: variable(0.008901283144950867)\n",
      "Itr 75 loss: variable(0.008876156993210316)\n"
     ]
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# now we can perform gradient descent to improve this model\n",
    "model = L.Linear(in_size=1, out_size=1)\n",
    "losses = []\n",
    "print(model)\n",
    "learning_rate = 0.5\n",
    "for i in range(100):\n",
    "    model.cleargrads()\n",
    "    loss = F.mean(F.square(model(data_x[:, None]) - data_y[:, None]))\n",
    "    losses.append(float(loss.data))\n",
    "    ## *** YOUR CODE HERE TO PERFORM GRADIENT DESCENT ***\n",
    "    ## Hint: you could access gradients with model.W.grad, model.b.grad\n",
    "    ## Hint2: you could write data into a parameter with model.W.data[:] = some_numpy_array\n",
    "    ## Hint3: if your model doesn't learn, remember to try different learning rate\n",
    "    \n",
    "    loss.backward()\n",
    "\n",
    "    \n",
    "    model.W.data -= learning_rate*model.W.grad\n",
    "    model.b.data -= learning_rate*model.b.grad\n",
    "    \n",
    "    \n",
    "    if i % 25 == 0:\n",
    "        print(\"Itr\", i, \"loss:\", loss)\n",
    "plt.plot(np.array(losses))\n",
    "plt.title(\"Learning curve\")\n",
    "plt.figure()\n",
    "plt.plot(data_x, model(data_x[:, None])[:,0].data, c='r')\n",
    "plt.scatter(data_x, data_y, c='b')\n",
    "_ = plt.title(\"Trained model fitness\")\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Train your first deep model\n",
    "\n",
    "Now we have learned the basics of Chainer. We can use it to train a deep model to classify MNIST digits. We will train a model on the MNIST dataset because the dataset is small.\n",
    "\n",
    "First we load the data and see what the images look like:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 78,
   "metadata": {
    "scrolled": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Downloading from http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz...\n",
      "Downloading from http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz...\n",
      "Downloading from http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz...\n",
      "Downloading from http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz...\n",
      "train[i][0] is the ith image that's flattened, and has shape: (784,)\n",
      "train[i][1] is the ith image's label, such as: 3\n"
     ]
    },
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAP8AAAEICAYAAACQ6CLfAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDMuMC4wLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvqOYd8AAAEQ1JREFUeJzt3XuQVOWdxvHvw0VQVAKLAqsoqOxGNqmQZBQrGINxo8YqV1NGC2p12cSEVEU3m1pNrUVVopuKtZaJSYwmriQSUaNZa43BKGV0qTVEXYmji4JBvCJeEFS8gBdu89s/urFGnH576D7dp533+VRNTc/5ncuPZp453f2e7lcRgZnlZ1DZDZhZORx+s0w5/GaZcvjNMuXwm2XK4TfLlMOfMUl3SfpKu7e1zuDwDwCSVkv627L7qEXSTEmrJL0uab2kBZL2Lruv3Dn81g73ANMjYiRwEDAE+F65LZnDP4BJGiXpVkkvSXq1env/nVY7WNKfqmflhZJG99r+CEn3SnpN0kOSZjTSR0Q8GxEv91q0HTikkX1ZcRz+gW0Q8EvgQOAA4G3g8p3W+Qfgy8BfAtuAnwBI2g+4jcoZejRwLnCTpH12PoikA6p/IA6o1YikIyW9DmwETgF+3Nw/zZrl8A9gEfFKRNwUEW9FxEbgQuAzO612bUSsiIg3gW8Dp0kaDJwOLIqIRRHRExF3At3ACX0cZ01EfCgi1iR6ubv6sH9/4PvA6kL+kdYwh38Ak7SHpCslPSPpDWAJ8KFquHd4ttftZ4ChwBgqjxZOrZ7RX5P0GnAkML6ZniLieeB24NfN7MeaN6TsBqylzgH+GpgWES9Kmgr8H6Be60zodfsAYCvwMpU/CtdGxFdb0NcQ4OAW7Nd2gc/8A8dQScN7fQ0B9qLyPP+16gt55/ex3emSpkjaA/gu8F8RsR24DjhR0nGSBlf3OaOPFwzrkvT31dcFJOlAKk8/Fjf8L7VCOPwDxyIqQd/xdQGVF9V2p3Imv4/Kw+2dXQtcDbwIDAe+AZVX6IGTgLnAS1QeCXyLPn5nqsHelHjBbwpwL7CJyrDfKqAVjyhsF8gf5mGWJ5/5zTLl8JtlyuE3y5TDb5apto7z76ZhMZwR7TykWVbe4U22xGbVX7PJ8Es6HrgUGAz8IiIuSq0/nBFM0zHNHNLMEpZG/y+faPhhf/US0Z8Cn6cyjjtL0pRG92dm7dXMc/7DgSci4qmI2ELlWu2TimnLzFqtmfDvx3vfFPJcddl7SJojqVtS91Y2N3E4MytSM+Hv60WF910uGBHzIqIrIrqGMqyJw5lZkZoJ/3O89x1h+wMvNNeOmbVLM+G/H5gsaZKk3YCZwC3FtGVmrdbwUF9EbJN0NvB7KkN98yPikcI6M7OWamqcPyIWUXkrqZl9wPjyXrNMOfxmmXL4zTLl8JtlyuE3y5TDb5Yph98sUw6/WaYcfrNMOfxmmXL4zTLl8JtlyuE3y5TDb5Yph98sUw6/WaYcfrNMOfxmmXL4zTLl8JtlyuE3y5TDb5Yph98sUw6/WaYcfrNMOfxmmXL4zTLl8JtlyuE3y1RTs/R2ksGjRiXrz555aLI+5J30/l+buqVmbeietWsAd0+/Iln/8pNfTNYfe3GfZL2Vtq3fPVmftHBbsj5k8QNFtmMFair8klYDG4HtwLaI6CqiKTNrvSLO/EdHxMsF7MfM2sjP+c0y1Wz4A7hD0gOS5vS1gqQ5kroldW9lc5OHM7OiNPuwf3pEvCBpX+BOSY9GxJLeK0TEPGAewN4aHU0ez8wK0tSZPyJeqH5fD9wMHF5EU2bWeg2HX9IISXvtuA0cC6woqjEza61mHvaPBW6WtGM/10fE7YV01YCV/z45WX/ixMvb1Elf0mPlCyfflt48/U8r1bZTtifrP3n1wzVr8247NrntIde+mqz3rHg0Wbe0hsMfEU8BHyuwFzNrIw/1mWXK4TfLlMNvlimH3yxTDr9ZpgbMW3q/d/RNpR172Zb021oveeG4NnXyfkufnpisT5u0OlmfvOf6ZP07Y5Yn6/8y6vHatdNr1wCmL/96sj7SV5U0xWd+s0w5/GaZcvjNMuXwm2XK4TfLlMNvlimH3yxTA2ac/7rT0m8PvewjI5P1USteb/jYgza+naxve2p1w/tu1iGk3xb7Sp3tX/uLscn67+57Jlk/cY836hyhtldOSH+e+sjrGt614TO/WbYcfrNMOfxmmXL4zTLl8JtlyuE3y5TDb5apATPO3/PQymR95EN1tm/m2E1s2+nWzqz90dsAJ+7x3w3v+9We9PURE+YPbnjfVp/P/GaZcvjNMuXwm2XK4TfLlMNvlimH3yxTDr9ZpgbMOL/1bdDw4cn64/PT4/j3fvr7dY6Qnn48ZeYZ/5SsD73rgYb3bfXVPfNLmi9pvaQVvZaNlnSnpMer30e1tk0zK1p/HvZfDRy/07LzgMURMRlYXP3ZzD5A6oY/IpYAG3ZafBKwoHp7AXBywX2ZWYs1+oLf2IhYC1D9vm+tFSXNkdQtqXsrmxs8nJkVreWv9kfEvIjoioiuoQxr9eHMrJ8aDf86SeMBqt/TU7maWcdpNPy3ALOrt2cDC4tpx8zape44v6QbgBnAGEnPAecDFwE3SjoTWAOc2somLe3NU6bVrL0y863ktqs+Nb/O3tPj+Jsi/TrO9MvPqVmbcH/6QxYG8uckdIK64Y+IWTVKxxTci5m1kS/vNcuUw2+WKYffLFMOv1mmHH6zTPktvR8AW4/tStbvuPSymrVhau1/cU9Esr7ns7UH7GLbtqLbsV3gM79Zphx+s0w5/GaZcvjNMuXwm2XK4TfLlMNvlimP838APP1FJeutHstP2XtQ+qPB77n4ZzVrc8/9RHLbmxYfkawfdPM7ybruWZas585nfrNMOfxmmXL4zTLl8JtlyuE3y5TDb5Yph98sU4o678cu0t4aHdPkD/3dVZtPOCxZ3+Nbz9esXTAxPaXCJ3cb3FBPnWAb25P1D9/29Zq1KRe+mN73M8821FPZlsZi3ogN6QtDqnzmN8uUw2+WKYffLFMOv1mmHH6zTDn8Zply+M0y5XH+AW7woZOT9S3j9krW3xy/W7L+yt+lpwB/5NO/rFkbRL+Go1viS2tmJOvrpr+Z3kFP+hqDshQ6zi9pvqT1klb0WnaBpOclLat+ndBMw2bWfv152H81cHwfy38UEVOrX4uKbcvMWq1u+CNiCbChDb2YWRs184Lf2ZIerj4tGFVrJUlzJHVL6t7K5iYOZ2ZFajT8VwAHA1OBtcAltVaMiHkR0RURXUMZ1uDhzKxoDYU/ItZFxPaI6AF+DhxebFtm1moNhV/S+F4/fgFYUWtdM+tMdcf5Jd0AzADGAOuA86s/TwUCWA18LSLW1juYx/nzs/7sT9WsffZL9yW3vXhcd9Ht9NuhC85K1ifN/d82dbJrdmWcv+5sDxExq4/FV+1yV2bWUXx5r1mmHH6zTDn8Zply+M0y5fCbZcpTdFtL7Xv5vTVrj1yZfrvwV/74mWT9FxP+0FBP/TIp/VblgcBnfrNMOfxmmXL4zTLl8JtlyuE3y5TDb5Yph98sUx7nt9LE1i3J+l3LP5beQQvH+fXkHi3bd6fwmd8sUw6/WaYcfrNMOfxmmXL4zTLl8JtlyuE3y5TH+dtgyEETk/VVZ41L1kc+lv4k5jFXdubHSNejIelfv2lTnmzZsd+O9DUG45Z25hTcRfKZ3yxTDr9Zphx+s0w5/GaZcvjNMuXwm2XK4TfLVN1xfkkTgGuAcUAPMC8iLpU0GvhPYCKVabpPi4hXW9dq5xoy6cBk/aiFjyTrt4z+TbJ+4tTjkvVOHpEeMvGAmrU/n5e+vuGJif9RdDvv+umrH03Wh//uTy07dqfoz5l/G3BORBwKHAGcJWkKcB6wOCImA4urP5vZB0Td8EfE2oh4sHp7I7AS2A84CVhQXW0BcHKrmjSz4u3Sc35JE4GPA0uBsRGxFip/IIB9i27OzFqn3+GXtCdwE/DNiHhjF7abI6lbUvdWNjfSo5m1QL/CL2koleD/KiJ2vDq1TtL4an08sL6vbSNiXkR0RUTXUIYV0bOZFaBu+CUJuApYGRE/7FW6BZhdvT0bWFh8e2bWKv15S+904AxguaRl1WVzgYuAGyWdCawBTm1Ni51v/WXpRzTnjl7V1P63Ttk/WR/y4Ds1az0bNzZ17EF77ZWsP/Zvf5Os33HKD2rWJg5p7uOxByt97np666aatdu+fXRy290Z+EN9dcMfEXcDtd5Qfkyx7ZhZu/gKP7NMOfxmmXL4zTLl8JtlyuE3y5TDb5Ypf3R3Ad5ZMia9wseb2//t11+VrH/35dpvT33yzX2aOvbBI15K1m8d87M6e2jdVNepcXyAM845p2ZtxG+XFt3OB47P/GaZcvjNMuXwm2XK4TfLlMNvlimH3yxTDr9ZpjzOX4D9F21I1g87clayfv8nb2jq+N8Zs7x2sc4lCGWqN032R2/9RrI+8eaeZH3E7z2Wn+Izv1mmHH6zTDn8Zply+M0y5fCbZcrhN8uUw2+WKY/zF6BnxaPJ+tiZ6fe0Hzb7rGR901FvJet6svb+j/rcw8lt6/nDU4c0tf2eS2r3Nnplevq2v7pr4H92fpl85jfLlMNvlimH3yxTDr9Zphx+s0w5/GaZcvjNMqWISK8gTQCuAcYBPcC8iLhU0gXAV4EdH+w+NyIWpfa1t0bHNHlWb7NWWRqLeSM2qD/r9ucin23AORHxoKS9gAck3Vmt/SgiftBoo2ZWnrrhj4i1wNrq7Y2SVgL7tboxM2utXXrOL2kilcmndnw+0tmSHpY0X9KoGtvMkdQtqXsr6cs5zax9+h1+SXsCNwHfjIg3gCuAg4GpVB4ZXNLXdhExLyK6IqJrKMMKaNnMitCv8EsaSiX4v4qI3wBExLqI2B4RPcDPgcNb16aZFa1u+CUJuApYGRE/7LV8fK/VvgCsKL49M2uV/rzaPx04A1guaVl12VxglqSpQACrga+1pEMza4n+vNp/N9DXuGFyTN/MOpuv8DPLlMNvlimH3yxTDr9Zphx+s0w5/GaZcvjNMuXwm2XK4TfLlMNvlimH3yxTDr9Zphx+s0w5/GaZqvvR3YUeTHoJeKbXojHAy21rYNd0am+d2he4t0YV2duBEbFPf1Zsa/jfd3CpOyK6SmsgoVN769S+wL01qqze/LDfLFMOv1mmyg7/vJKPn9KpvXVqX+DeGlVKb6U+5zez8pR95jezkjj8ZpkqJfySjpe0StITks4ro4daJK2WtFzSMkndJfcyX9J6SSt6LRst6U5Jj1e/9zlHYkm9XSDp+ep9t0zSCSX1NkHS/0haKekRSf9cXV7qfZfoq5T7re3P+SUNBh4DPgc8B9wPzIqIP7e1kRokrQa6IqL0C0IkHQVsAq6JiI9Ul10MbIiIi6p/OEdFxL92SG8XAJvKnra9OpvU+N7TygMnA/9Iifddoq/TKOF+K+PMfzjwREQ8FRFbgF8DJ5XQR8eLiCXAhp0WnwQsqN5eQOWXp+1q9NYRImJtRDxYvb0R2DGtfKn3XaKvUpQR/v2AZ3v9/Bwl3gF9COAOSQ9ImlN2M30YGxFrofLLBOxbcj87qzttezvtNK18x9x3jUx3X7Qywt/X1F+dNN44PSI+AXweOKv68Nb6p1/TtrdLH9PKd4RGp7svWhnhfw6Y0Ovn/YEXSuijTxHxQvX7euBmOm/q8XU7Zkiufl9fcj/v6qRp2/uaVp4OuO86abr7MsJ/PzBZ0iRJuwEzgVtK6ON9JI2ovhCDpBHAsXTe1OO3ALOrt2cDC0vs5T06Zdr2WtPKU/J912nT3ZdyhV91KOPHwGBgfkRc2PYm+iDpICpne6jMYHx9mb1JugGYQeUtn+uA84HfAjcCBwBrgFMjou0vvNXobQaVh67vTtu+4zl2m3s7EvgjsBzoqS6eS+X5dWn3XaKvWZRwv/nyXrNM+Qo/s0w5/GaZcvjNMuXwm2XK4TfLlMNvlimH3yxT/w9XDMitmCMwZQAAAABJRU5ErkJggg==\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "train, test = chainer.datasets.get_mnist()\n",
    "# use train[data_point_index] to access data\n",
    "print(\"train[i][0] is the ith image that's flattened, and has shape:\", train[12][0].shape)\n",
    "print(\"train[i][1] is the ith image's label, such as:\", train[12][1])\n",
    "# here we visualize two of them\n",
    "plt.imshow(train[12][0].reshape([28, 28,]))\n",
    "plt.title(\"Label: %s\" % train[12][1])\n",
    "plt.figure()\n",
    "plt.imshow(train[42][0].reshape([28, 28,]))\n",
    "_ = plt.title(\"Label: %s\" % train[42][1])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next we will provide some boilerplate code and train a linear classifier as an example:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 83,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "accuracy: 0.125; loss: 2.50304079056\n",
      "accuracy: 0.8625; loss: 0.564959187508\n",
      "accuracy: 0.8925; loss: 0.479897476435\n",
      "accuracy: 0.885; loss: 0.384544897377\n",
      "accuracy: 0.915; loss: 0.342601635754\n",
      "accuracy: 0.8975; loss: 0.349747369289\n",
      "accuracy: 0.885; loss: 0.409698887169\n",
      "accuracy: 0.91; loss: 0.362917580009\n",
      "accuracy: 0.92; loss: 0.293132980168\n",
      "accuracy: 0.9; loss: 0.375784979463\n",
      "accuracy: 0.905; loss: 0.278993033469\n",
      "accuracy: 0.9175; loss: 0.310299986303\n",
      "accuracy: 0.895; loss: 0.354688770473\n",
      "accuracy: 0.9125; loss: 0.369913563728\n",
      "accuracy: 0.9025; loss: 0.345520782471\n",
      "accuracy: 0.92; loss: 0.268177085519\n",
      "accuracy: 0.92; loss: 0.289943566918\n",
      "accuracy: 0.92; loss: 0.267333188355\n",
      "accuracy: 0.8975; loss: 0.344296744466\n",
      "accuracy: 0.8925; loss: 0.337183906436\n",
      "accuracy: 0.905; loss: 0.353583359718\n",
      "accuracy: 0.9275; loss: 0.314473261833\n",
      "accuracy: 0.905; loss: 0.281501327455\n",
      "accuracy: 0.9075; loss: 0.292442364395\n",
      "accuracy: 0.9275; loss: 0.271261479557\n",
      "accuracy: 0.915; loss: 0.258744972944\n"
     ]
    }
   ],
   "source": [
    "def run(model, batchsize=16, num_epochs=2):\n",
    "    \n",
    "    optimizer = chainer.optimizers.Adam() # we will use chainer's Adam implementation instead of writing our own gradient based optimization\n",
    "    optimizer.setup(model)\n",
    "    \n",
    "    stats = defaultdict(lambda: deque(maxlen=25))\n",
    "    for epoch in range(num_epochs):\n",
    "        train_iter = chainer.iterators.SerialIterator(train, batchsize, repeat=False, shuffle=True)\n",
    "        test_iter = chainer.iterators.SerialIterator(test, batchsize, repeat=False, shuffle=False)\n",
    "        \n",
    "        for itr, batch in enumerate(train_iter):\n",
    "            xs = np.concatenate([datum[0][None, :] for datum in batch])\n",
    "            ys = np.array([datum[1] for datum in batch])\n",
    "\n",
    "            logits = model(xs)\n",
    "\n",
    "            loss = F.softmax_cross_entropy(logits, ys)\n",
    "            model.cleargrads()\n",
    "            loss.backward()\n",
    "            optimizer.update()\n",
    "            \n",
    "            # calculate stats\n",
    "            stats[\"loss\"].append(float(loss.data))\n",
    "            stats[\"accuracy\"].append(float((logits.data.argmax(1) == ys).sum() / batchsize))\n",
    "            if itr % 300 == 0:\n",
    "                print(\"; \".join(\"%s: %s\" % (k, np.mean(vs)) for k, vs in stats.items()))\n",
    "\n",
    "# try a simple linear model\n",
    "run(L.Linear(None, 10))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next we will try to improve performance by training an MLP instead. A partial implementation is provided for you to fill in:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 95,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "accuracy: 0.0625; loss: 2.46682453156\n",
      "accuracy: 0.825; loss: 0.630960577726\n",
      "accuracy: 0.9; loss: 0.360144178271\n",
      "accuracy: 0.915; loss: 0.293309667706\n",
      "accuracy: 0.9175; loss: 0.243787847757\n",
      "accuracy: 0.9025; loss: 0.303641338646\n",
      "accuracy: 0.945; loss: 0.234546657801\n",
      "accuracy: 0.95; loss: 0.21599093169\n",
      "accuracy: 0.9325; loss: 0.215736034513\n",
      "accuracy: 0.9425; loss: 0.19298216939\n",
      "accuracy: 0.945; loss: 0.208931932151\n",
      "accuracy: 0.9275; loss: 0.228774641156\n",
      "accuracy: 0.9725; loss: 0.144196992517\n",
      "accuracy: 0.95; loss: 0.18372646153\n",
      "accuracy: 0.955; loss: 0.13742869556\n",
      "accuracy: 0.9375; loss: 0.150678778291\n",
      "accuracy: 0.9575; loss: 0.165121055245\n",
      "accuracy: 0.9525; loss: 0.148270180225\n",
      "accuracy: 0.9725; loss: 0.110782767534\n",
      "accuracy: 0.9725; loss: 0.0823058307171\n",
      "accuracy: 0.9675; loss: 0.119388193488\n",
      "accuracy: 0.95; loss: 0.167229778767\n",
      "accuracy: 0.965; loss: 0.100753335953\n",
      "accuracy: 0.9625; loss: 0.131165284514\n",
      "accuracy: 0.9675; loss: 0.114250488281\n",
      "accuracy: 0.9625; loss: 0.124719848037\n"
     ]
    }
   ],
   "source": [
    "class MLP(chainer.Chain): # MLP is a multilayer perceptron\n",
    "\n",
    "    def __init__(self, n_units, n_out):\n",
    "        super(MLP, self).__init__()\n",
    "        with self.init_scope():\n",
    "            # the size of the inputs to each layer will be inferred\n",
    "            self.l1 = L.Linear(None, n_units)  # n_in -> n_units\n",
    "            self.l2 = L.Linear(None, n_units)  # n_units -> n_units\n",
    "            self.l3 = L.Linear(None, n_out)  # n_units -> n_out\n",
    "\n",
    "    def __call__(self, x):\n",
    "        # *** YOUR CODE HERE TO BUILD AN MLP W/ self.l1, self.l2, self.l3 ***\n",
    "        x = F.sigmoid(self.l1(x))#first layer\n",
    "        x = F.sigmoid(self.l2(x))#second layer\n",
    "        x = self.l3(x)#output\n",
    "        return x\n",
    "        # Hint: you should make use of non-linearities / activation functions\n",
    "        #     https://docs.chainer.org/en/stable/reference/functions.html#activation-functions\n",
    "        raise NotImplementedError()\n",
    "run(MLP(200, 10))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next you should try to implement logging test loss and see if the model is overfitting."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 96,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "accuracy: 0.125; loss: 2.46960759163\n",
      "accuracy: 0.82; loss: 0.624884361029\n",
      "accuracy: 0.9025; loss: 0.360504755378\n",
      "accuracy: 0.9225; loss: 0.262705806494\n",
      "accuracy: 0.9275; loss: 0.232269071341\n",
      "accuracy: 0.9; loss: 0.342205162048\n",
      "accuracy: 0.94; loss: 0.226253433824\n",
      "accuracy: 0.915; loss: 0.29725666225\n",
      "accuracy: 0.9125; loss: 0.243943879604\n",
      "accuracy: 0.93; loss: 0.219373792708\n",
      "accuracy: 0.9475; loss: 0.171774392128\n",
      "accuracy: 0.935; loss: 0.223409476578\n",
      "accuracy: 0.9375; loss: 0.222163057327\n",
      "accuracy: 0.95; loss: 0.139273769557\n",
      "accuracy: 0.9275; loss: 0.204066659212\n",
      "accuracy: 0.955; loss: 0.125167305768\n",
      "accuracy: 0.95; loss: 0.137372402847\n",
      "accuracy: 0.97; loss: 0.111475832462\n",
      "accuracy: 0.9525; loss: 0.151010400951\n",
      "accuracy: 0.9575; loss: 0.134647907913\n",
      "accuracy: 0.9475; loss: 0.199485819042\n",
      "accuracy: 0.965; loss: 0.12123409301\n",
      "accuracy: 0.9725; loss: 0.0819953000546\n",
      "accuracy: 0.975; loss: 0.120456190705\n",
      "accuracy: 0.97; loss: 0.092969968915\n",
      "accuracy: 0.9775; loss: 0.107619660497\n"
     ]
    }
   ],
   "source": [
    "def better_run(model, batchsize=16, num_epochs=2):\n",
    "\n",
    "    optimizer = chainer.optimizers.Adam() # we will use chainer's Adam implementation instead of writing our own gradient based optimization\n",
    "    optimizer.setup(model)\n",
    "    \n",
    "    stats = defaultdict(lambda: deque(maxlen=25))\n",
    "    for epoch in range(num_epochs):\n",
    "        train_iter = chainer.iterators.SerialIterator(train, batchsize, repeat=False, shuffle=True)\n",
    "        for itr, batch in enumerate(train_iter):\n",
    "            xs = np.concatenate([datum[0][None, :] for datum in batch])\n",
    "            ys = np.array([datum[1] for datum in batch])\n",
    "\n",
    "            logits = model(xs)\n",
    "\n",
    "            loss = F.softmax_cross_entropy(logits, ys)\n",
    "            model.cleargrads()\n",
    "            loss.backward()\n",
    "            optimizer.update()\n",
    "            \n",
    "            # calculate stats\n",
    "            stats[\"loss\"].append(float(loss.data))\n",
    "            stats[\"accuracy\"].append(float((logits.data.argmax(1) == ys).sum() / batchsize))\n",
    "            if itr % 300 == 0:\n",
    "                test_iter = chainer.iterators.SerialIterator(test, batchsize, repeat=False, shuffle=False)\n",
    "                # *** YOUR CODE implement logging of stats on test set ***\n",
    "                print(\"; \".join(\"%s: %s\" % (k, np.mean(vs)) for k, vs in stats.items()))\n",
    "\n",
    "better_run(MLP(200, 10))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Try different variants!\n",
    "\n",
    "- Does using a ConvNet improve performance (reduce overfitting?)\n",
    "- Try changing the learning rate and observe the effect\n",
    "- Does the model train if you give it correlated gradients? (consecutively sample many batches of \"1\", then many batches of \"2\", ... etc"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python [conda env:deeprlbootcamp]",
   "language": "python",
   "name": "conda-env-deeprlbootcamp-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.5.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 1
}
